#!/bin/bash

echo "ğŸ” Debugging Route Generation Issue"
echo "===================================="

echo ""
echo "1. âœ… Checking if app is running:"
if curl -s http://localhost:8081 > /dev/null; then
    echo "   âœ… App is running at http://localhost:8081"
else
    echo "   âŒ App not running. Please run 'npm run dev' first."
    exit 1
fi

echo ""
echo "2. ğŸ” Key questions to investigate:"
echo "   - Do you have vehicles with packages?"
echo "   - Do the vehicles have coordinates (lat/lng)?"
echo "   - Do the packages have destination coordinates?"
echo "   - Is the MapBox token working?"

echo ""
echo "3. ğŸ§ª Testing steps to perform:"
echo "=========================="
echo ""
echo "Step 1: Add a test vehicle"
echo "   - Go to 'Add Vehicle' tab"
echo "   - Vehicle ID: TEST-001"
echo "   - Driver: Test Driver"
echo "   - Location: Type 'San Francisco, CA' and select from dropdown"
echo "   - Click Submit"
echo ""
echo "Step 2: Add a test package"
echo "   - Go to 'Add Package' tab"
echo "   - Package ID: PKG-TEST"
echo "   - Vehicle: Select TEST-001"
echo "   - Destination: Type 'Oakland, CA' and select from dropdown"
echo "   - Weight: 10"
echo "   - Recipient: Test Customer"
echo "   - Click Submit"
echo ""
echo "Step 3: Generate route"
echo "   - Go to 'Fleet' tab"
echo "   - Click on vehicle TEST-001 on the map"
echo "   - In the sidebar, click 'ğŸ—ºï¸ Generate Route' button"
echo "   - Check browser console (F12) for detailed logs"
echo ""
echo "4. ğŸ” What to look for in browser console:"
echo "========================================"
echo "âœ… Expected logs when clicking Generate Route:"
echo "   ğŸš€ Generating route for vehicle TEST-001"
echo "   ğŸ“ Creating route with X destinations"
echo "   ğŸŒ MapBox API coordinates string: lng,lat;lng,lat"
echo "   ğŸ“¡ Making request to MapBox Directions API..."
echo "   âœ… MapBox API success: {...}"
echo "   ğŸ—ºï¸ Route displayed on map for TEST-001"
echo ""
echo "âŒ Error logs to watch for:"
echo "   âŒ Vehicle TEST-001 has no coordinates"
echo "   âŒ Vehicle TEST-001 has no packages"
echo "   âŒ MapBox token not available"
echo "   âŒ MapBox API error: {...}"
echo ""
echo "5. ğŸ¯ Visual checks:"
echo "=================="
echo "âœ… Debug panel (bottom right) should show:"
echo "   - Vehicles: 1+ (after adding vehicles)"
echo "   - With Packages: 1+ (after adding packages)"
echo "   - MapBox Token: âœ…"
echo ""
echo "âœ… On the map after generating route:"
echo "   - Blue curved line from vehicle to package destination"
echo "   - Line should follow roads, not be straight"
echo "   - Checkpoints/markers at destinations"
echo ""
echo "6. ğŸš¨ Common issues and fixes:"
echo "=============================="
echo "Issue: 'No coordinates' error"
echo "   â†’ Make sure you selected an address from the dropdown"
echo "   â†’ Don't just type text - select the autocomplete suggestion"
echo ""
echo "Issue: 'No packages' error"  
echo "   â†’ Make sure package was assigned to the correct vehicle"
echo "   â†’ Check that package destination has coordinates"
echo ""
echo "Issue: MapBox API error"
echo "   â†’ Check internet connection"
echo "   â†’ Verify MapBox token is valid"
echo "   â†’ Check browser network tab for failed requests"
echo ""
echo "7. ğŸ‰ Success indicators:"
echo "========================"
echo "âœ… Blue route line appears on map following roads"
echo "âœ… Console shows all success messages"
echo "âœ… Vehicle sidebar shows route distance/duration"
echo "âœ… Debug panel shows 'With Routes: 1+'"

echo ""
echo "Open browser console (F12) and follow the steps above! ğŸš€"