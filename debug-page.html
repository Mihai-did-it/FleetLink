<!DOCTYPE html>
<html>
<head>
    <title>FleetLink Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; font-family: monospace; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>🔍 FleetLink Debug Test</h1>
    
    <div class="section">
        <h2>🗺️ MapBox API Tests</h2>
        <button onclick="testGeocoding()">Test Geocoding</button>
        <button onclick="testDirections()">Test Directions</button>
        <div id="api-results" class="log"></div>
    </div>

    <div class="section">
        <h2>📱 Application Tests</h2>
        <p>Instructions:</p>
        <ol>
            <li>Open the main application in another tab: <a href="http://localhost:8081" target="_blank">FleetLink App</a></li>
            <li>Open browser console (F12) and watch for debug messages</li>
            <li>Try adding a vehicle with location search</li>
            <li>Try generating a route for a vehicle</li>
        </ol>
        
        <h3>Expected Debug Messages:</h3>
        <div class="log">
🎯 LocationFinder: Suggestion selected: {...}
📍 LocationFinder: Calling onLocationSelect with: {...}
🚛 AddVehicleTab: Location selected: {...}
🚛 AddVehicleTab: Updated newVehicle: {...}
🚛 AddVehicleTab: handleAddVehicle called with: {...}
✅ [LOCAL] Vehicle added: VEHICLE-ID
🔵 Route button clicked for vehicle: VEHICLE-ID
🎯 generateRouteForVehicle called with vehicle: {...}
🚀 Generating route for vehicle VEHICLE-ID
        </div>
    </div>

    <script>
        const MAPBOX_TOKEN = 'pk.eyJ1IjoibW5pZmFpIiwiYSI6ImNtZjM5dng3dzAxZWYybHEwdmZ2MmE4MDkifQ.CGxxP82dHH4tu6V9D6FhHg';
        
        function log(message) {
            const div = document.getElementById('api-results');
            div.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
        }
        
        async function testGeocoding() {
            log('🌍 Testing MapBox Geocoding API...');
            try {
                const query = 'Times Square New York';
                const url = `https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${MAPBOX_TOKEN}&limit=5&types=place,locality,neighborhood,address`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                log(`✅ Geocoding Success: Found ${data.features?.length || 0} results`);
                if (data.features && data.features.length > 0) {
                    log(`📍 First result: ${data.features[0].place_name}`);
                    log(`📍 Coordinates: [${data.features[0].center[1]}, ${data.features[0].center[0]}]`);
                }
            } catch (error) {
                log(`❌ Geocoding Error: ${error.message}`);
            }
        }
        
        async function testDirections() {
            log('🛣️ Testing MapBox Directions API...');
            try {
                const start = '-73.9857,40.7484'; // Times Square
                const end = '-73.9442,40.8176';   // Columbia University
                const url = `https://api.mapbox.com/directions/v5/mapbox/driving/${start};${end}?access_token=${MAPBOX_TOKEN}&overview=full&geometries=geojson`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                log(`✅ Directions Success: Found ${data.routes?.length || 0} routes`);
                if (data.routes && data.routes.length > 0) {
                    log(`🛣️ Distance: ${(data.routes[0].distance / 1000).toFixed(2)} km`);
                    log(`⏱️ Duration: ${Math.round(data.routes[0].duration / 60)} minutes`);
                    log(`🗺️ Has geometry: ${!!data.routes[0].geometry}`);
                }
            } catch (error) {
                log(`❌ Directions Error: ${error.message}`);
            }
        }
    </script>
</body>
</html>